<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City of Fairfield Ordinance Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Chosen Palette: Royal (Purple, Gold, and White) -->
    
    <!-- Application Structure Plan: 
         A clean, search-first dashboard approach. 
         1. Header: Persistent search bar and category filters for immediate task execution.
         2. Main View: A responsive grid of "Ordinance Cards" acting as summaries.
         3. Interaction: Clicking a card opens a detailed modal overlaid on the screen.
         This structure is chosen because users typically look up ordinances with a specific problem in mind (e.g., "dogs", "weeds", "noise"), making a search-driven grid the most frictionless UX. 
    -->
    
    <!-- Visualization & Content Choices: 
         - Goal: Inform and Organize. 
         - Method: Interactive text-based grid with category tagging and Emoji icons (NO SVG/Mermaid). 
         - Interaction: Dynamic filtering via JS based on user text input and category buttons. Modals for drill-down details to keep the main view uncluttered.
         - Justification: Best for browsing a large index of textual legal summaries.
    -->
    
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #faf5ff; /* purple-50 */
        }

        /* Smooth card hover effects */
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-color: #d8b4fe; /* purple-300 */
        }

        /* Custom scrollbar for the modal */
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #d8b4fe; border-radius: 10px; }
        
        /* Modal Animation classes */
        .modal-enter { opacity: 0; transform: scale(0.95); }
        .modal-enter-active { opacity: 1; transform: scale(1); transition: opacity 200ms, transform 200ms; }
    </style>
</head>
<body class="text-gray-800 min-h-screen flex flex-col">

    <!-- Header & Search -->
    <header class="bg-purple-900 text-white sticky top-0 z-40 shadow-md border-b-4 border-amber-500">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <div class="bg-amber-500 text-purple-950 font-bold text-xl h-10 w-10 flex items-center justify-center rounded-lg shadow-inner">
                        FA
                    </div>
                    <div>
                        <h1 class="text-xl font-bold leading-tight">City of Fairfield Alabama</h1>
                        <p class="text-purple-300 text-xs uppercase tracking-wider">Ordinance Directory</p>
                    </div>
                </div>
                
                <div class="w-full md:w-1/2 lg:w-1/3 relative">
                    <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-purple-300">üîç</span>
                    <input type="text" id="searchInput" placeholder="Search ordinances, keywords, or numbers..." 
                           class="w-full pl-10 pr-4 py-2 bg-purple-800 border border-purple-700 rounded-lg text-white placeholder-purple-300 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent transition-all">
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
        
        <!-- Welcome & Instructions Section -->
        <div class="mb-8 bg-white p-6 sm:p-8 rounded-xl border border-purple-200 shadow-sm">
            <div class="flex flex-col lg:flex-row lg:items-start justify-between gap-8 mb-6">
                
                <!-- Descriptive Text -->
                <div class="space-y-4 text-gray-700 max-w-4xl text-sm sm:text-base leading-relaxed">
                    <h2 class="text-2xl font-bold text-purple-950">Welcome to the new City of Fairfield Ordinance Explorer!</h2>
                    
                    <p>Think of this webpage as a quick, digital "cheat sheet" for our city's local laws. We know that reading through pages of heavy legal documents isn't always easy, so we've built this tool to help you quickly understand the rules that keep Fairfield safe, clean, and running smoothly.</p>

                    <h3 class="font-bold text-purple-900 text-lg mt-6">Here is how this tool helps you:</h3>
                    
                    <ul class="list-none space-y-3">
                        <li class="flex items-start">
                            <span class="text-amber-500 mr-2 mt-0.5">üîç</span>
                            <span><strong class="text-purple-900">Search Instantly:</strong> Wondering about the rules for neighborhood noise, parking an RV, or keeping your grass cut? Just type a keyword (like "dogs," "fireworks," or "weeds") into the search bar, and the right rule will instantly appear.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-amber-500 mr-2 mt-0.5">üìÇ</span>
                            <span><strong class="text-purple-900">Browse by Category:</strong> Want to know what the rules are for local businesses or property maintenance? Use the filter buttons below to sort the laws into easy topics like <em>Public Safety</em>, <em>Traffic & Parking</em>, or <em>Property & Environment</em>.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-amber-500 mr-2 mt-0.5">üìã</span>
                            <span><strong class="text-purple-900">Get the Bottom Line:</strong> Click on any ordinance card to open a quick, plain-English summary. It will tell you exactly <em>why</em> the rule exists, the <em>key rules</em> you need to follow, and the <em>fines or penalties</em> for breaking them.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="text-amber-500 mr-2 mt-0.5">üîó</span>
                            <span><strong class="text-purple-900">Access Official Documents:</strong> If you ever need to read the exact, legal wording of a law, there are direct links provided that will take you straight to the official City of Fairfield website.</span>
                        </li>
                    </ul>

                    <p class="pt-3">Whether you are a homeowner checking property guidelines, a business owner looking up food truck rules, or just a neighbor wanting to stay informed, this tool is designed to make Fairfield's laws clear, accessible, and easy to find for everyone!</p>
                </div>

                <!-- Official Docs Button -->
                <a href="https://cityoffairfieldal.org/ova_doc/ordinances/" target="_blank" rel="noopener noreferrer" class="shrink-0 inline-flex items-center gap-2 px-5 py-2.5 bg-amber-500 text-purple-950 font-bold rounded-lg hover:bg-amber-400 transition-colors shadow-sm whitespace-nowrap">
                    üìÑ Official Documents ‚Üó
                </a>
            </div>
            
            <!-- Category Filters -->
            <div class="border-t border-purple-100 pt-6 mt-2">
                <h3 class="text-sm font-bold text-purple-900 uppercase tracking-wide mb-3">Filter Ordinances by Category:</h3>
                <div id="filterContainer" class="flex flex-wrap gap-2">
                    <!-- Filters injected by JS -->
                </div>
            </div>
        </div>

        <!-- Results Summary -->
        <div class="mb-4 flex justify-between items-end border-b border-purple-200 pb-2">
            <h3 class="font-semibold text-purple-900">Ordinances Directory</h3>
            <span id="resultCount" class="text-sm text-purple-800 bg-purple-100 px-2 py-1 rounded-md font-medium"></span>
        </div>

        <!-- Grid -->
        <div id="ordinanceGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Cards injected by JS -->
        </div>

    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-purple-200 py-6 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center text-sm text-gray-500 flex flex-col gap-2 items-center">
            <p class="max-w-3xl leading-relaxed"><strong>Disclaimer:</strong> This website is an independent informational tool. It is not the official website of the City of Fairfield. For official legal text, please refer to the City‚Äôs official published ordinances.</p>
            <a href="https://cityoffairfieldal.org/ova_doc/ordinances/" target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-1 font-bold text-purple-700 hover:text-purple-900 transition-colors bg-purple-50 px-3 py-1.5 rounded border border-purple-200 shadow-sm mt-2">
                View Official City Ordinances on cityoffairfieldal.org ‚Üó
            </a>
        </div>
    </footer>

    <!-- Detail Modal Overlays -->
    <div id="modalOverlay" class="fixed inset-0 bg-purple-950/60 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4 sm:p-6 transition-opacity">
        <div id="modalContent" class="bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden modal-enter border-t-4 border-amber-500">
            
            <!-- Modal Header -->
            <div class="bg-purple-50 px-6 py-4 border-b border-purple-200 flex justify-between items-start">
                <div>
                    <span id="modalCategory" class="text-xs font-bold uppercase tracking-wider text-amber-600 mb-1 block"></span>
                    <h2 id="modalTitle" class="text-xl sm:text-2xl font-bold text-purple-950"></h2>
                    <span id="modalId" class="inline-block mt-1 text-sm bg-purple-200 text-purple-900 font-medium px-2 py-0.5 rounded"></span>
                </div>
                <button id="closeModalBtn" class="text-purple-400 hover:text-purple-900 bg-white hover:bg-purple-100 rounded-full w-8 h-8 flex items-center justify-center transition-colors border border-purple-200 shadow-sm text-lg leading-none">
                    ‚úñ
                </button>
            </div>

            <!-- Modal Body (Scrollable) -->
            <div class="px-6 py-4 overflow-y-auto custom-scroll flex-grow space-y-6">
                
                <!-- Purpose -->
                <div>
                    <h3 class="text-sm font-bold text-purple-900 uppercase tracking-wide border-b border-purple-200 pb-1 mb-2">Purpose</h3>
                    <p id="modalPurpose" class="text-gray-700 leading-relaxed"></p>
                </div>

                <!-- Rules -->
                <div>
                    <h3 class="text-sm font-bold text-purple-900 uppercase tracking-wide border-b border-purple-200 pb-1 mb-2">Key Rules & Restrictions</h3>
                    <ul id="modalRules" class="list-disc pl-5 space-y-1.5 text-gray-700">
                        <!-- Rules injected via JS -->
                    </ul>
                </div>

                <!-- Penalties -->
                <div class="bg-red-50 rounded-lg p-4 border border-red-100">
                    <h3 class="text-sm font-bold text-red-800 uppercase tracking-wide mb-2 flex items-center gap-2">
                        <span>‚ö†Ô∏è</span> Enforcement & Penalties
                    </h3>
                    <ul id="modalPenalties" class="list-disc pl-5 space-y-1 text-red-900/80 text-sm">
                        <!-- Penalties injected via JS -->
                    </ul>
                </div>
            </div>
            
            <!-- Modal Footer -->
            <div class="bg-purple-50 px-6 py-4 border-t border-purple-200 flex justify-end">
                <button id="closeModalFooterBtn" class="bg-purple-900 hover:bg-purple-800 text-white px-5 py-2 rounded-lg font-medium transition-colors shadow-sm">
                    Close Guide
                </button>
            </div>
        </div>
    </div>

    <!-- Application Logic -->
    <script>
        // --- DATA ---
        const ordinances = [
            {
                id: "885", title: "Noise Control", category: "Public Safety", icon: "üîä",
                purpose: "To prevent excessive noise that disturbs the peace and quiet of the community.",
                rules: [
                    "Daytime (7 AM-10 PM) Residential limit: 55 dB(A).",
                    "Nighttime (10 PM-7 AM) Residential limit: 50 dB(A).",
                    "Commercial limit: 62 dB(A); Industrial limit: 70 dB(A).",
                    "Construction & power equipment permitted 7 AM - 10 PM.",
                    "No heavy vehicle idling (>10,000 lbs) for more than 10 mins near residences at night.",
                    "Off-road vehicles max 55 dB(A) at 50 feet."
                ],
                penalties: ["Up to $100 for standard violations.", "Up to $500 for repeat offenders (>3 times/year)."]
            },
            {
                id: "961", title: "Tow-Away Zones", category: "Traffic & Parking", icon: "üö´",
                purpose: "To enforce 'Prohibited Parking' designations and reduce traffic congestion.",
                rules: [
                    "Police can immediately remove/impound vehicles in marked 'No Parking' or 'Tow-Away' Zones.",
                    "Specific Zone: East side of 5217 Myron Massey Blvd to 53rd St.",
                    "Owners can redeem prior to sale by proving identity/ownership and paying all fees."
                ],
                penalties: ["Misdemeanor charge.", "Up to a $200 fine and/or up to 30 days imprisonment.", "Auction of vehicle after 3 months."]
            },
            {
                id: "878", title: "Abandoned & Wrecked Vehicles", category: "Traffic & Parking", icon: "üöó",
                purpose: "To keep public streets and private property clear of abandoned, dismantled, or junked vehicles.",
                rules: [
                    "Any vehicle left consecutively on a public street for 48 hours is presumed abandoned.",
                    "Strictly prohibited to leave partially dismantled, non-operating, wrecked, or junked vehicles on any street."
                ],
                penalties: ["Subject to impounding, sale, and further penalties."]
            },
            {
                id: "989", title: "Smoking in Public Places", category: "Public Safety", icon: "üö≠",
                purpose: "To regulate and reduce the use of lighted tobacco products in public places.",
                rules: [
                    "Prohibited in enclosed public spaces (restaurants, malls, libraries, etc.).",
                    "Strictly prohibited in City-owned buildings, vehicles, and facilities.",
                    "Prohibited in workplaces (employers can designate entire business non-smoking).",
                    "Designated smoking areas must be outdoors and clearly marked."
                ],
                penalties: ["Misdemeanor charge.", "Minimum $25 fine for first offense.", "Imprisonment as deemed advisable by court."]
            },
            {
                id: "1000", title: "Convicted Sex Offenders", category: "Public Safety", icon: "üö∑",
                purpose: "To regulate residency, employment, and loitering of adult convicted sex offenders.",
                rules: [
                    "Prohibited from living or working within 1 mile of any school, recreation, or child care facility.",
                    "Offenders (child victims) cannot loiter within 1,000 feet of schools/facilities.",
                    "Grandfather clause applies to lawful residence/work prior to ordinance."
                ],
                penalties: ["Up to a $500 fine.", "Up to 6 months imprisonment."]
            },
            {
                id: "962", title: "Weed Nuisances", category: "Property & Environment", icon: "üå±",
                purpose: "To abate overgrown weeds and grass on sidewalks, streets, or private property.",
                rules: [
                    "Unlawful to have overgrown weeds, grass, bushes exceeding 6 inches in height.",
                    "Prohibited vegetation includes growths hiding dangerous debris or causing fire threats.",
                    "Owners granted 21 days to remove illegal weeds after notice."
                ],
                penalties: ["City will abate the nuisance if uncorrected.", "Weed Lien Assessment of $1,000 (or actual cost) placed on property."]
            },
            {
                id: "2017-1100", title: "Loitering", category: "Public Safety", icon: "üõë",
                purpose: "To prohibit loitering for various unlawful or unauthorized purposes.",
                rules: [
                    "Prohibited for begging, gambling, prostitution, or unlawful drug use.",
                    "Masked loitering prohibited (except parades/parties).",
                    "Prohibited on school/college grounds without permission after being told to leave.",
                    "Prohibited in transport facilities to unauthorizedly solicit."
                ],
                penalties: ["Up to a $500 fine.", "Up to 6 months imprisonment."]
            },
            {
                id: "2017-1102", title: "Solid Waste", category: "Business & Utilities", icon: "üóëÔ∏è",
                purpose: "To establish mandatory garbage collection service for all properties.",
                rules: [
                    "Mandatory subscription for residences ($69/quarter) and businesses ($90/quarter).",
                    "Must use container with lid placed near public right-of-way.",
                    "Unlawful to sweep trash into streets/alleys or leave exposed to flies.",
                    "Exemptions available for sole-income Social Security households."
                ],
                penalties: ["Misdemeanor charge.", "Fine of $50 to $200 per day of violation.", "Unpaid fees lead to service suspension/civil action."]
            },
            {
                id: "1019", title: "Occupational License Fee", category: "Business & Utilities", icon: "üíº",
                purpose: "To implement a 1% fee on trades, occupations, and professions to supplement city revenue.",
                rules: [
                    "1% tax on gross receipts and compensation earned within city limits.",
                    "Employers must withhold fee from paychecks and remit quarterly.",
                    "Employees legally required to file/pay if employer fails to do so."
                ],
                penalties: ["Late payments face 12% annual interest + 10% penalty.", "Misdemeanor to fail to pay/withhold/file.", "Up to $500 fine and 30 days jail per offense."]
            },
            {
                id: "2019-1131", title: "Post-Construction Stormwater", category: "Property & Environment", icon: "üèóÔ∏è",
                purpose: "To manage post-construction stormwater runoff from new/re-development sites.",
                rules: [
                    "Applies to land disturbances of 1 acre or more.",
                    "BMPs must ensure pre-construction runoff volume/velocity is not exceeded.",
                    "Requires BMP Design, Inspection Plan, and Maintenance Plan.",
                    "Property owner/HOA responsible for long-term maintenance."
                ],
                penalties: ["City may perform repairs and bill owner or file a lien against the property if uncorrected after 14 days notice."]
            },
            {
                id: "2019-1136", title: "Commercial Vehicle Parking", category: "Traffic & Parking", icon: "üöõ",
                purpose: "To restrict commercial/heavy vehicle parking in unauthorized areas.",
                rules: [
                    "Unlawful to park in 'no parking' zones or private property without permission.",
                    "Residential streets: Must leave 16 feet of usable pavement.",
                    "Heavy Trucks (>19k lbs or >6 wheels) prohibited from overnight parking in city limits.",
                    "Exemptions: School buses, emergency vehicles, garbage trucks."
                ],
                penalties: ["Immediate towing.", "1st Offense: $250. 2nd Offense: $500. 3rd Offense: Mandatory court appearance."]
            },
            {
                id: "2019-1129", title: "Illicit Discharge", category: "Property & Environment", icon: "üö∞",
                purpose: "To regulate non-stormwater discharges into the municipal storm sewer system.",
                rules: [
                    "Illegal to discharge pollutants/non-stormwater into storm drains.",
                    "Illicit connections (sewage/sinks to storm system) strictly prohibited.",
                    "Spills must be reported immediately (hazardous) or next business day.",
                    "Exemptions for AC condensation, residential car washing, firefighting."
                ],
                penalties: ["Notice of Violation with 10 days to remediate.", "City may clean up and assess costs + 12% interest as lien.", "Up to $500/day fine and/or 180 days jail."]
            },
            {
                id: "2024-1156", title: "Fireworks", category: "Public Safety", icon: "üéÜ",
                purpose: "To regulate possession, sale, display, and disposal of fireworks.",
                rules: [
                    "Unlawful to possess/use/sell fireworks without compliance. Illegal fireworks are contraband.",
                    "Retail sales only permitted June 20 - July 6 & Dec 15 - Jan 1.",
                    "Sellers require city license ($339) and $100k/$300k liability insurance."
                ],
                penalties: ["Confiscation of contraband.", "Fines from $1.00 to $500.00 per violation."]
            },
            {
                id: "2024-1158", title: "Parking in Front Yard", category: "Property & Environment", icon: "üöò",
                purpose: "To prohibit parking motor vehicles on grass/front yards.",
                rules: [
                    "Unlawful to park vehicles, RVs, boats on front yard unless on paved/permitted driveway.",
                    "Unlawful to park over curbs, sidewalks, or unpaved rights-of-way.",
                    "Exceptions: Emergency vehicles, limited loading (max 5 hrs/day, 2x/month)."
                ],
                penalties: ["$50.00 fine per violation per day.", "Failure to pay/appear leads to arrest warrant, additional $50 fine, up to 5 days jail."]
            },
            {
                id: "2022-1146", title: "Care of Premises", category: "Property & Environment", icon: "üßπ",
                purpose: "To regulate sanitation and upkeep of commercial and residential premises.",
                rules: [
                    "Maintain premises in clean/sanitary condition.",
                    "Garbage must be in approved containers.",
                    "No open storage of inoperable vehicles, appliances, rubbish.",
                    "Occupants responsible for pest extermination."
                ],
                penalties: ["14-day grace period after Notice of Violation.", "Uncorrected issues result in citation to Municipal Court.", "Each day constitutes a separate offense."]
            },
            {
                id: "2017-1101", title: "Food Trucks", category: "Business & Utilities", icon: "üçî",
                purpose: "To establish regulations for mobile food vendors.",
                rules: [
                    "Must obtain city council franchise.",
                    "Location approved by Police; cannot be within 120ft of a restaurant without consent.",
                    "Hours: 6 AM to 5 PM (8 PM DST).",
                    "Requires $1,000,000 liability insurance."
                ],
                penalties: ["Revocation and termination of the franchise for violations."]
            },
            {
                id: "931", title: "Zoning Ordinance", category: "Property & Environment", icon: "üó∫Ô∏è",
                purpose: "To establish zoning districts and regulate land use/development.",
                rules: [
                    "Districts include Residential, Institutional, Office, Business, Industrial.",
                    "Usage restricted to permitted purposes in specific zones.",
                    "Establishes setbacks, heights, parking minimums, and buffer requirements.",
                    "Building permits required for construction/alteration."
                ],
                penalties: ["Fines from $10 to $1,000 per offense plus court costs.", "Each day is a separate offense."]
            },
            {
                id: "2019-1130", title: "Erosion & Sedimentation", category: "Property & Environment", icon: "üåç",
                purpose: "To reduce erosion from land-disturbing activities to protect waters.",
                rules: [
                    "Permit & BMP Plan required before commencing work.",
                    "$1,000 permit fee. Security bond required ($2k-$5k/acre).",
                    "Exemptions: Agriculture, minor home gardening."
                ],
                penalties: ["Compliance/cease-and-desist orders.", "Misdemeanor charge. Fines $100 to $500 and/or up to 180 days jail."]
            },
            {
                id: "2025-1164", title: "Building and Fire Code", category: "Public Safety", icon: "üè¢",
                purpose: "To formally adopt modern safety and construction standards.",
                rules: [
                    "Adopts the 2021 International Building and Fire Code.",
                    "Effective as of April 7, 2025."
                ],
                penalties: ["Subject to standard code enforcement penalties."]
            },
            {
                id: "835", title: "Canines & Rabies Control", category: "Animal Control", icon: "üêï",
                purpose: "To regulate keeping dogs, mandate rabies vaccines, and prevent nuisance barking.",
                rules: [
                    "Dogs are prohibited from running at large; must be confined to premises.",
                    "Unlawful to keep any dog not properly vaccinated against rabies.",
                    "Owners prohibited from permitting loud, frequent, or continued nuisance barking."
                ],
                penalties: ["Impoundment, sale, or destruction of dogs at large.", "Fines up to $500 and/or up to 180 days in City Jail."]
            },
            {
                id: "2024-60", title: "Bingo and Gaming", category: "Business & Utilities", icon: "üéüÔ∏è",
                purpose: "To authorize and regulate charity bingo operations per Constitutional Amendments.",
                rules: [
                    "Legal exclusively for non-profit organizations raising funds for charity/education in Jefferson County.",
                    "Organizations must be properly licensed by the City of Fairfield.",
                    "Repeals and supersedes any previous city bingo ordinances."
                ],
                penalties: ["Fines up to $500.00.", "License forfeiture.", "Violators ineligible to participate/serve as officer for 2 years."]
            }
        ];

        // --- STATE & DOM ---
        let currentCategory = "All";
        const grid = document.getElementById('ordinanceGrid');
        const searchInput = document.getElementById('searchInput');
        const filterContainer = document.getElementById('filterContainer');
        const resultCount = document.getElementById('resultCount');
        
        // Modal Elements
        const modal = document.getElementById('modalOverlay');
        const modalContent = document.getElementById('modalContent');
        
        // --- INITIALIZATION ---
        function init() {
            // Extract unique categories
            const categories = ["All", ...new Set(ordinances.map(o => o.category))];
            
            // Render Filter Buttons
            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = `px-4 py-1.5 rounded-full text-sm font-medium transition-colors border shadow-sm ${cat === 'All' ? 'bg-purple-900 text-white border-purple-900' : 'bg-white text-purple-800 border-purple-200 hover:bg-purple-50'}`;
                btn.innerText = cat;
                btn.onclick = () => {
                    currentCategory = cat;
                    updateFilterUI();
                    renderGrid();
                };
                filterContainer.appendChild(btn);
            });

            // Listeners
            searchInput.addEventListener('input', renderGrid);
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            document.getElementById('closeModalFooterBtn').addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if(e.target === modal) closeModal();
            });

            renderGrid();
        }

        // --- RENDER LOGIC ---
        function updateFilterUI() {
            Array.from(filterContainer.children).forEach(btn => {
                if(btn.innerText === currentCategory) {
                    btn.className = 'px-4 py-1.5 rounded-full text-sm font-medium transition-colors border shadow-sm bg-purple-900 text-white border-purple-900';
                } else {
                    btn.className = 'px-4 py-1.5 rounded-full text-sm font-medium transition-colors border shadow-sm bg-white text-purple-800 border-purple-200 hover:bg-purple-50';
                }
            });
        }

        function renderGrid() {
            const query = searchInput.value.toLowerCase();
            
            const filtered = ordinances.filter(ord => {
                const matchCat = currentCategory === "All" || ord.category === currentCategory;
                const matchSearch = ord.title.toLowerCase().includes(query) || 
                                    ord.purpose.toLowerCase().includes(query) || 
                                    ord.id.includes(query);
                return matchCat && matchSearch;
            });

            resultCount.innerText = `${filtered.length} Results`;
            grid.innerHTML = '';

            if (filtered.length === 0) {
                grid.innerHTML = `<div class="col-span-full py-12 text-center text-purple-500 bg-white rounded-xl border border-purple-200">No ordinances found matching your search.</div>`;
                return;
            }

            filtered.forEach(ord => {
                const card = document.createElement('div');
                card.className = "bg-white border border-purple-200 rounded-xl p-5 cursor-pointer card-hover flex flex-col h-full";
                card.onclick = () => openModal(ord);
                card.innerHTML = `
                    <div class="flex items-start justify-between mb-3">
                        <div class="text-3xl bg-purple-50 w-12 h-12 flex items-center justify-center rounded-lg">${ord.icon}</div>
                        <span class="text-xs font-bold text-purple-700 bg-purple-100 px-2 py-1 rounded">ORD ${ord.id}</span>
                    </div>
                    <div class="text-xs font-bold uppercase tracking-wider text-amber-600 mb-1">${ord.category}</div>
                    <h3 class="text-lg font-bold text-purple-950 mb-2 leading-tight">${ord.title}</h3>
                    <p class="text-gray-600 text-sm line-clamp-3 mb-4 flex-grow">${ord.purpose}</p>
                    <div class="mt-auto pt-3 border-t border-purple-100 flex justify-between items-center text-sm font-bold text-purple-800">
                        <span>View Details</span>
                        <span class="text-lg leading-none text-amber-500">‚Üí</span>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // --- MODAL LOGIC ---
        function openModal(ord) {
            document.getElementById('modalCategory').innerText = ord.category;
            document.getElementById('modalTitle').innerText = ord.title;
            document.getElementById('modalId').innerText = `Ordinance ${ord.id}`;
            document.getElementById('modalPurpose').innerText = ord.purpose;
            
            const rulesUl = document.getElementById('modalRules');
            rulesUl.innerHTML = ord.rules.map(r => `<li>${r}</li>`).join('');
            
            const penUl = document.getElementById('modalPenalties');
            penUl.innerHTML = ord.penalties.map(p => `<li>${p}</li>`).join('');

            modal.classList.remove('hidden');
            // Trigger animation
            requestAnimationFrame(() => {
                modalContent.classList.add('modal-enter-active');
            });
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeModal() {
            modalContent.classList.remove('modal-enter-active');
            setTimeout(() => {
                modal.classList.add('hidden');
                document.body.style.overflow = '';
            }, 200); // match transition duration
        }

        // Start App
        init();
    </script>
</body>
</html>